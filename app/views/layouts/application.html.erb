<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "My App" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <%# Enable PWA manifest for installable apps (make sure to enable in config/routes.rb too!) %>
    <%#= tag.link rel: "manifest", href: pwa_manifest_path(format: :json) %>
    <script src="https://cdn.tailwindcss.com"></script>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">
    <link rel="manifest" href="/manifest.json">
    <%# Includes all stylesheet files in app/assets/stylesheets %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body>
    <% if user_signed_in? %>
      <div data-controller="notification"
          data-notification-user-id-value="<%= current_user.id %>">
      </div>
    <% end %>
    <% unless devise_controller? %>
      <%= render "shared/navbar" %>
    <% end %>
    <div id="global-loading" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-white/80 backdrop-blur-sm">
      <div class="text-center">
        <svg class="animate-spin h-12 w-12 text-indigo-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
        <p class="mt-4 text-gray-700 font-medium">Loading...</p>
      </div>
    </div>
    <turbo-frame id="followers_modal"></turbo-frame>    
    <%= yield %>
  </body>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('new-post-form');
    const loadingOverlay = document.getElementById('global-loading');

    if (!form || !loadingOverlay) return;

    form.addEventListener('submit', () => {
      // Show full-screen loading
      loadingOverlay.classList.remove('hidden');
      // Optional: Prevent user from closing or interacting
      document.body.style.overflow = 'hidden';
    });
  });
  </script>
</html>
