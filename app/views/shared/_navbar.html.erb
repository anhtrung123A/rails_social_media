<nav class="bg-white border-b border-gray-100 sticky top-0 z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16 items-center">

      <!-- Logo -->
      <div class="flex-shrink-0">
        <%= link_to "/", class: "text-2xl font-extrabold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent hover:opacity-90 transition", data: { turbo: false } do %>
          Luna
        <% end %>
      </div>

      <!-- Right Side: Auth Links or User Menu -->
      <div class="flex items-center space-x-2 sm:space-x-4">

        <% if user_signed_in? %>
          <!-- Avatar Button -->
          <%= link_to profile_path(current_user),
                      class: "group flex-shrink-0 w-8 h-8 sm:w-10 sm:h-10 rounded-full overflow-hidden ring-2 ring-white ring-offset-2 ring-offset-gray-50 hover:ring-indigo-500 transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-indigo-500" do %>
            <%= avatar_for(current_user, class: "w-full h-full object-cover group-hover:scale-105 transition-transform duration-200") %>
          <% end %>

          <!-- Name (hidden on mobile) -->
          <span class="hidden sm:inline-block text-sm font-medium text-gray-800 truncate max-w-[120px] md:max-w-xs">
            <%= current_user.full_name || current_user.email %>
          </span>
          <!-- Conversations Link -->
          <div class="relative">
            <%= link_to conversations_path, class: "group flex-shrink-0 p-2 rounded-full text-gray-600 hover:text-indigo-600 transition-colors duration-150 relative" do %>
              <svg class="w-[24px] h-[24px]" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path d="M4.99951 16.55V19.9C4.99922 20.3102 5.11905 20.7114 5.34418 21.0542C5.56931 21.397 5.88994 21.6665 6.26642 21.8292C6.6429 21.9919 7.05875 22.0408 7.46271 21.9698C7.86666 21.8989 8.24103 21.7113 8.53955 21.4301L11.1495 18.9701H12.0195C17.5395 18.9701 22.0195 15.1701 22.0195 10.4701C22.0195 5.77009 17.5395 1.97009 12.0195 1.97009C6.49953 1.97009 2.01953 5.78009 2.01953 10.4701C2.042 11.6389 2.32261 12.7882 2.84125 13.8358C3.35989 14.8835 4.10373 15.8035 5.01953 16.53L4.99951 16.55Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path> </g></svg>
              <!-- Notification dot if there are unread messages -->
              <% if current_user.unread_messages_count > 0 %>
                <span class="absolute right-0 block h-2 w-2 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 ring-2 ring-white bottom-[3rem]"></span>
              <% end %>
            <% end %>
          </div>
          <div class="relative">
            <%= link_to conversations_path, class: "group flex-shrink-0 p-2 rounded-full text-gray-600 hover:text-indigo-600 transition-colors duration-150 relative" do %>
              <svg class="w-[24px] h-[24px]" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <path fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C7.71983 1.25 4.25004 4.71979 4.25004 9V9.7041C4.25004 10.401 4.04375 11.0824 3.65717 11.6622L2.50856 13.3851C1.17547 15.3848 2.19318 18.1028 4.51177 18.7351C5.26738 18.9412 6.02937 19.1155 6.79578 19.2581L6.79768 19.2632C7.56667 21.3151 9.62198 22.75 12 22.75C14.378 22.75 16.4333 21.3151 17.2023 19.2632L17.2042 19.2581C17.9706 19.1155 18.7327 18.9412 19.4883 18.7351C21.8069 18.1028 22.8246 15.3848 21.4915 13.3851L20.3429 11.6622C19.9563 11.0824 19.75 10.401 19.75 9.7041V9C19.75 4.71979 16.2802 1.25 12 1.25ZM15.3764 19.537C13.1335 19.805 10.8664 19.8049 8.62349 19.5369C9.33444 20.5585 10.571 21.25 12 21.25C13.4289 21.25 14.6655 20.5585 15.3764 19.537ZM5.75004 9C5.75004 5.54822 8.54826 2.75 12 2.75C15.4518 2.75 18.25 5.54822 18.25 9V9.7041C18.25 10.6972 18.544 11.668 19.0948 12.4943L20.2434 14.2172C21.0086 15.3649 20.4245 16.925 19.0936 17.288C14.4494 18.5546 9.5507 18.5546 4.90644 17.288C3.57561 16.925 2.99147 15.3649 3.75664 14.2172L4.90524 12.4943C5.45609 11.668 5.75004 10.6972 5.75004 9.7041V9Z" fill="currentColor"></path> </g></svg>              <!-- Notification dot if there are unread messages -->
              <% if current_user.unread_messages_count > 0 %>
                <span class="absolute right-0 block h-2 w-2 rounded-full bg-gradient-to-r from-indigo-600 to-purple-600 ring-2 ring-white bottom-[3rem]"></span>
              <% end %>
            <% end %>
          </div>


          <!-- Divider -->
          <div class="hidden sm:block w-px h-6 bg-gray-300"></div>

          <!-- Logout -->
          <%= link_to "Logout", destroy_user_session_path,
                      method: :delete,
                      data: { turbo: false, confirm: "Are you sure you want to log out?" },
                      class: "text-sm font-medium text-gray-600 hover:text-indigo-600 hover:bg-gray-50 px-3 py-2 rounded-lg transition-colors duration-150" %>

        <% else %>
          <!-- Guest Links -->
          <%= link_to "Login", new_user_session_path, class: "text-sm font-medium text-gray-700 hover:text-indigo-600 px-3 py-2 rounded-md hover:bg-gray-50 transition" %>

          <%= link_to "Sign Up", new_user_registration_path, class: "text-sm font-semibold text-white bg-gradient-to-r from-indigo-600 to-purple-600 hover:bg-indigo-700 px-4 py-2 rounded-lg shadow-sm hover:shadow transition" %>
        <% end %>

      </div>
    </div>
  </div>
</nav>